<!DOCTYPE html><html lang="en" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.3" /><meta property="og:title" content="Essential SSH hardening guide (Server, client and fail2ban)" /><meta property="og:locale" content="en" /><meta name="description" content="Harden the default SSH configuration settings to reduce your system’s attack surface on both your server and client. Also, install and configure fail2ban in your server." /><meta property="og:description" content="Harden the default SSH configuration settings to reduce your system’s attack surface on both your server and client. Also, install and configure fail2ban in your server." /><link rel="canonical" href="https://rubenhortas.github.io/posts/ssh-hardening-server-client-fail2ban-guide/" /><meta property="og:url" content="https://rubenhortas.github.io/posts/ssh-hardening-server-client-fail2ban-guide/" /><meta property="og:site_name" content="rubenhortas@blog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2025-11-22T01:00:01+01:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Essential SSH hardening guide (Server, client and fail2ban)" /><meta name="twitter:site" content="@rubenhortas" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2026-01-31T22:52:17+01:00","datePublished":"2025-11-22T01:00:01+01:00","description":"Harden the default SSH configuration settings to reduce your system’s attack surface on both your server and client. Also, install and configure fail2ban in your server.","headline":"Essential SSH hardening guide (Server, client and fail2ban)","mainEntityOfPage":{"@type":"WebPage","@id":"https://rubenhortas.github.io/posts/ssh-hardening-server-client-fail2ban-guide/"},"url":"https://rubenhortas.github.io/posts/ssh-hardening-server-client-fail2ban-guide/"}</script><title>Essential SSH hardening guide (Server, client and fail2ban) | rubenhortas@blog</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="rubenhortas@blog"><meta name="application-name" content="rubenhortas@blog"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.20.1/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/avatar.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title"> <a href="/">rubenhortas@blog</a></div><div class="site-subtitle font-italic">Learning everyday</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="javascript:location.href = 'mailto:' + ['rubenhortas','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="https://www.linkedin.com/in/rubenhortas" aria-label="linkedin" target="_blank" rel="noopener noreferrer"> <i class="fab fa-linkedin"></i> </a> <a href="https://github.com/rubenhortas" aria-label="github" target="_blank" rel="noopener noreferrer"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/rubenhortas" aria-label="twitter" target="_blank" rel="noopener noreferrer"> <i class="fab fa-twitter"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Essential SSH hardening guide (Server, client and fail2ban)</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Essential SSH hardening guide (Server, client and fail2ban)</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1763769601" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Nov 22, 2025 </em> </span> <span> Updated <em class="" data-ts="1769896337" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Jan 31, 2026 </em> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://github.com/rubenhortas">Rubén Hortas</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2256 words"> <em>12 min</em> read</span></div></div></div><div class="post-content"><p>Harden the default SSH configuration settings to reduce your system’s attack surface on both your server and client. Also, install and configure <a href="https://github.com/fail2ban/fail2ban">fail2ban</a> in your server.</p><h2 id="why"><span class="mr-2">Why?</span><a href="#why" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>SSH is the privileged gateway for remote administration of almost any server or network device (in many cases, this includes personal computers and/or gadgets), which makes it a prime target for attackers.</p><p>We must harden SSH to prevent attackers from exploiting weak configurations and gaining access to our devices, thereby protecting both our devices and the rest of our network.</p><p>The goal of hardening is to eliminate (or reduce) inherent vulnerabilities that may exist in the default configuration of a service.</p><h2 id="keep-your-system-updated-"><span class="mr-2">Keep your system updated ;)</span><a href="#keep-your-system-updated-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Keeping your system updated is the primary way to patch security vulnerabilities. Therefore, the first step, and one of the most important steps in hardening (both on the server side and on the client side) is to keep your system updated.</p><h2 id="server-hardening"><span class="mr-2">Server hardening</span><a href="#server-hardening" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="the-configuration-file"><span class="mr-2">The configuration file</span><a href="#the-configuration-file" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>To harden SSH, on the server side, we are going to change certain settings in the SSH configuration file: <code class="language-plaintext highlighter-rouge">/etc/ssh/sshd_config</code>.</p><p>To configure the values, we can uncomment the lines (commented out) and edit the values. However, I prefer to leave the original line commented out and place the line with the new value directly below it. This is a quick way to see if we have modified a default configuration (and what its default value was) when we review the file, when we add new configurations, or when we modify existing settings. If you prefer to edit the values directly, I recommend you make a backup of the original configuration file.</p><p>After changing the settings, we’ll need to restart the SSH service for the changes to take effect.</p><h3 id="change-the-default-ssh-port"><span class="mr-2">Change the default SSH port</span><a href="#change-the-default-ssh-port" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Security by obscurity is never the solution, and <strong>port change is hardly a silver bullet</strong>, but it will deter automated attacks.</p><p><code class="language-plaintext highlighter-rouge">Port 1023</code> # Generally used for testing</p><blockquote class="prompt-warning"><p>Changing the port can create a security issue. The catch here is that changing the port can create a security issue called “Non-Privileged Port Binding” or “Ephemeral Port Hijacking”. While Linux restricts privileged ports (1-1023) to the root user, any unprivileged local user is able to bind and listen to unprivileged ports (1024-65535). Therefore, if our SSH server is running on, say, port 2222, and it crashes, a local user could start a fake SSH server on this port.</p></blockquote><p>My choice here is to implement Port Forwarding from the external firewall. I would open port 22222 in the firewall and redirect that traffic to port 22 of the machine running the SSH server.</p><h3 id="reduce-maxauthtries"><span class="mr-2">Reduce MaxAuthTries</span><a href="#reduce-maxauthtries" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Reduce the maximum number of authentication attempts permitted per network connection. Once the limit is reached, the server drops the connection. This will help us mitigate possible brute-force attacks.</p><p><code class="language-plaintext highlighter-rouge">MaxAuthTries 3</code></p><h3 id="reduce-maxsessions"><span class="mr-2">Reduce MaxSessions</span><a href="#reduce-maxsessions" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Reduce the number of “sessions” (like shell windows or file transfers) that can be opened over a single network connection (multiplexing). This will help us to prevent resource exhaustion and minimize the potential damage of a session hijacking (since the attacker cannot open new sessions without re-authenticating).</p><p><code class="language-plaintext highlighter-rouge">MaxSessions 2</code></p><blockquote class="prompt-warning"><p>SSH clients often try several authentication methods (like different SSH keys) automatically. If you have 5 keys in your ssh-agent, you might hit a limit of 3 before you even get to type a password or login.</p></blockquote><h3 id="disable-x11-forwarding"><span class="mr-2">Disable X11 forwarding</span><a href="#disable-x11-forwarding" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>If we are not going to use graphical applications via SSH, it is best to disable it. The main reason for disabling X11 forwarding is the possibility of an attacker gaining access to your local X server session if the remote SSH server is compromised.</p><p><code class="language-plaintext highlighter-rouge">X11Forwarding no</code></p><h3 id="disable-tcp-forwarding"><span class="mr-2">Disable TCP Forwarding</span><a href="#disable-tcp-forwarding" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>By disabling TCP forwarding prevents a compromised SSH session from being used as a bridge to attack other systems. If an attacker gains access to a limited user account, they can use TCP forwarding to bypass firewalls and poking around your internal network. Disabling TCP forwarding an attacker cannot tunner network traffic through the SSH connection.</p><p><code class="language-plaintext highlighter-rouge">AllowTcpForwarding no</code></p><h3 id="disable-agent-forwarding"><span class="mr-2">Disable agent forwarding</span><a href="#disable-agent-forwarding" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>We will disable agent forwarding because it creates a security risk by allowing the compromissed remote machine to use our local SSH private keys for <em>any</em> subsequent connection.</p><p><code class="language-plaintext highlighter-rouge">AllowAgentForwarding no</code></p><h3 id="restrict-root-login"><span class="mr-2">Restrict root login</span><a href="#restrict-root-login" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>On a well-configured system, the <code class="language-plaintext highlighter-rouge">root</code> account should be disabled already. Disabling the <code class="language-plaintext highlighter-rouge">root</code> account and elevating privileges using <code class="language-plaintext highlighter-rouge">sudo</code> is a good security practice. Anyway, we are going to disable it:</p><p><code class="language-plaintext highlighter-rouge">PermitRootLogin no</code></p><h3 id="limit-users-andor-groups-that-can-log-in"><span class="mr-2">Limit users and/or groups that can log in:</span><a href="#limit-users-andor-groups-that-can-log-in" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>We will specify which users and/or groups are allowed to access through SSH.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>AllowUsers rubenhortas rhortas
AllowGroups rubenhortas rhortas ssh
</pre></table></code></div></div><blockquote class="promt-warning"><p>The users and groups are examples. You have to add your own users and groups.</p></blockquote><p>If a user is listed in <code class="language-plaintext highlighter-rouge">AllowUsers</code> or belongs to a group listed in <code class="language-plaintext highlighter-rouge">AllowGroups</code>, they are allowed access. If neither <code class="language-plaintext highlighter-rouge">AllowUsers</code> nor <code class="language-plaintext highlighter-rouge">AllowGroups</code> is specified, all users are permitted to log in (assuming they have credentials).</p><blockquote class="prompt-info"><p>You should consider using only one approach (<code class="language-plaintext highlighter-rouge">AllowUsers</code> or <code class="language-plaintext highlighter-rouge">AllowGroups</code>) if possible. My personal approach is to use only <code class="language-plaintext highlighter-rouge">AllowUsers</code> because I have few users to manage.</p></blockquote><h3 id="configure-the-idle-timeout"><span class="mr-2">Configure the idle timeout</span><a href="#configure-the-idle-timeout" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>We are going to set up an inactiviy timeout to prevent sessions from remaining open indefinitely.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>ClientAliveInterval 300 # The server will send the client a message every 300 seconds if there is no activity
ClientAliveCountMax 2   # If the client does not respond to 2 messages in 10 minutes (300 x 2 = 600 seconds), the connection is terminated
</pre></table></code></div></div><blockquote class="prompt-warning"><p>At this point, we have to be careful not to set values so restrictive that they cut off our connections.</p></blockquote><blockquote class="prompt-info"><p>Alternatively, for non-SSH specific shell timeouts, consider using the TMOUT environment variable in the shell profile.</p></blockquote><h3 id="disable-password-authentication"><span class="mr-2">Disable password authentication.</span><a href="#disable-password-authentication" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Use only public/private key authentication.</p><p>You can learn how to use RSA keys as authentication method here: <a href="https://rubenhortas.github.io/posts/ssh-without-password-using-rsa-keys/">SSH without password, using RSA keys</a></p><p>After we have RSA key authentication set up and working, we are going to disable <code class="language-plaintext highlighter-rouge">PasswordAuthentication</code>:</p><p><code class="language-plaintext highlighter-rouge">PasswordAuthentication no</code></p><p>And we will to enable <code class="language-plaintext highlighter-rouge">PubkeyAuthentication</code>:</p><p><code class="language-plaintext highlighter-rouge">PubkeyAuthentication yes</code></p><h3 id="explicity-enforce-protocol-2"><span class="mr-2">Explicity enforce Protocol 2</span><a href="#explicity-enforce-protocol-2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>While modern SSH server software defaults to using the secure <code class="language-plaintext highlighter-rouge">Protocol 2</code>, and the modern and secure approach is to simply <em>not</em> specify the protocol, explicitly setting the directive could be a critical step in hardening our server. SSH <code class="language-plaintext highlighter-rouge">Protocol 1</code>is insecure and has known severe vulnerabilities. Explicty setting the configuration ensures that <code class="language-plaintext highlighter-rouge">Protocol 1</code>is never accepted, even if a client attempts to negotiate it.</p><p><code class="language-plaintext highlighter-rouge">Protocol 2</code></p><h3 id="force-the-use-of-modern-algorithms"><span class="mr-2">Force the use of modern algorithms</span><a href="#force-the-use-of-modern-algorithms" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>We will define a strict list of preferred modern algorithms. The server’s list will determine the algorithms used if the client supports them.</p><h4 id="key-exchange-algorithms"><span class="mr-2">Key Exchange Algorithms</span><a href="#key-exchange-algorithms" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>We need to harden our Key Exchange Algorithms using algorithms that uses modern elliptic curve cryptography (ECC) and strong Diffie-Hellman methods, offering excellent security and performance.</p><p><code class="language-plaintext highlighter-rouge">KexAlgorithms curve25519-sha256@libssh.org,diffie-hellman-group-exchange-sha256</code></p><h4 id="macs-integrity"><span class="mr-2">MACs (integrity)</span><a href="#macs-integrity" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>MACs (Message Authentication Codes) ensure the data has not been tampered with in transit. We should prioritize <strong>Encrypt-then-MAC (EtM)</strong> algorithms.</p><p><code class="language-plaintext highlighter-rouge">MACs hmac-sha2-512-etm@openssh.com,hmac-sha2-256-etm@openssh.com,umac-128-etm@openssh.com</code></p><h4 id="ciphers-encryption"><span class="mr-2">Ciphers (encryption)</span><a href="#ciphers-encryption" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Ciphers encrypt the data channel. It’s best to prioritize <strong>Authenticated Encryption with Associated Data (AEAD)</strong> ciphers like <code class="language-plaintext highlighter-rouge">chacha20-poly1305</code> and <code class="language-plaintext highlighter-rouge">aes-gcm</code>.</p><p><code class="language-plaintext highlighter-rouge">Ciphers chacha20-poly1305@openssh.com,aes256-gcm@openssh.com,aes128-gcm@openssh.com,aes256-ctr,aes192-ctr,aes128-ctr</code></p><h3 id="explicity-disable-rhosts"><span class="mr-2">Explicity disable rhosts</span><a href="#explicity-disable-rhosts" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>rhosts was a weak method to authenticate systems. It defines a way to trust another system simply by its IP address. By default is already disabled, but it’s better to disable it explicitly.</p><p><code class="language-plaintext highlighter-rouge">IgnoreRhosts yes</code></p><h3 id="reboot-ssh-service"><span class="mr-2">Reboot SSH service</span><a href="#reboot-ssh-service" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>We have to restart the SSH service for the changes to take effect.</p><p><code class="language-plaintext highlighter-rouge">sudo systemctl restart ssh</code></p><h3 id="bonus-fail2ban"><span class="mr-2">Bonus: fail2ban</span><a href="#bonus-fail2ban" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><a href="https://github.com/fail2ban/fail2ban">fail2ban</a> monitors failed login attempts in the logs and blocks the IPs addresses they originate from in the firewall.</p><h4 id="installation"><span class="mr-2">Installation</span><a href="#installation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><code class="language-plaintext highlighter-rouge">sudo apt install fail2ban</code></p><h4 id="configuration"><span class="mr-2">Configuration</span><a href="#configuration" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>The default configuration is acceptable, but I preffer to tighten it. To configure <a href="https://github.com/fail2ban/fail2ban">fail2ban</a> we will edit the file <code class="language-plaintext highlighter-rouge">/etc/fail2ban/jail.local</code>. My <code class="language-plaintext highlighter-rouge">/etc/fail2ban/jail.local</code> file (commented) as an example:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>[sshd]                      # Defines a jail targeting the SSH daemon
enabled = true              # Activates this jail
backend = systemd           # Method to monitor the logs
port = ssh
filter = sshd               # Use the predefined sshd filter to detect SSH authentication failures in the logs
maxretry = 1                # Maximum number of failed login attempts allowed before an IP address is banned
findtime = 1m               # Time window during which the maxretry count is calculated
bantime = 1m                # Ban duration
</pre></table></code></div></div><blockquote class="prompt-info"><p>There was a time when I had the ban set to last forever, but it ended up with so many IPs that it degraded performance.</p></blockquote><p>My <code class="language-plaintext highlighter-rouge">fail2ban</code> configuration could be quite aggressive. Since I have disabled password authentication, any failed login attempt is highly unlikely to be a legitimate user. Therefore, setting <code class="language-plaintext highlighter-rouge">maxretry = 1</code> and <code class="language-plaintext highlighter-rouge">findtime = 1m</code> is effective, because any password attempt will be considereded an attack, justifying the aggressive ban.</p><h4 id="enable-and-start-fail2ban-service"><span class="mr-2">Enable and start fail2ban service</span><a href="#enable-and-start-fail2ban-service" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>sudo systemctl enable fail2ban
sudo systemctl start fail2ban
</pre></table></code></div></div><h2 id="client-hardening"><span class="mr-2">Client hardening</span><a href="#client-hardening" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="the-configuration-files"><span class="mr-2">The configuration files</span><a href="#the-configuration-files" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>To harden SSH, on the client side, we are going to change certain settings in one of the two SSH configuration files: <code class="language-plaintext highlighter-rouge">/etc/ssh/ssh_config</code> or <code class="language-plaintext highlighter-rouge">~/.ssh/config</code>.</p><ul><li><p><code class="language-plaintext highlighter-rouge">/etc/ssh/ssh_config</code></p><p>This file holds the system-wide configuration. It defines the default configuration for all users on the system.</p><p>To configure the values, we can uncomment the lines (if commented out) and edit the values. However, as I said before, I prefer to leave the original line commented out and place the line with the new value directly below it. If you prefer to edit the values directly, I recommend you make a backup of the original configuration file.</p><li><p><code class="language-plaintext highlighter-rouge">~/.ssh/config</code></p><p>This file defines custom configurations for the user and specific hosts or groups of hosts:</p><ul><li>Specific host configuration</ul><p>To add a specific host, you create a new configuration block starting with the <code class="language-plaintext highlighter-rouge">Host</code> option and a unique alias for that host:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre>  Host rubenhortas-dev
      HostName 192.168.1.1
      PreferredAuthentications publickey
      PasswordAuthentication no
      HostBasedAuthentication no
      StrictHostKeyChecking ask
      KexAlgorithms curve25519-sha256@libssh.org,diffie-hellman-group-exchange-sha256
      MACs hmac-sha2-512-etm@openssh.com,hmac-sha2-256-etm@openssh.com,umac-128-etm@openssh.com
      Ciphers chacha20-poly1305@openssh.com,aes256-gcm@openssh.com,aes128-gcm@openssh.com
      ForwardX11 no
      ForwardAgent no
      ...
</pre></table></code></div></div><ul><li>Default configuration for all hosts</ul><p>The <code class="language-plaintext highlighter-rouge">Host *</code> entry applies to all hosts, but its settings are applied hierarchically. The <code class="language-plaintext highlighter-rouge">Host *</code> settings will be applied to every single connection, unless they are overridden by a more specific <code class="language-plaintext highlighter-rouge">Host</code> entry. We will add the hardening settings in this block.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre>  Host *
      PreferredAuthentications publickey
      PasswordAuthentication no
      HostBasedAuthentication no
      StrictHostKeyChecking ask
      KexAlgorithms curve25519-sha256@libssh.org,diffie-hellman-group-exchange-sha256
      MACs hmac-sha2-512-etm@openssh.com,hmac-sha2-256-etm@openssh.com,umac-128-etm@openssh.com
      Ciphers chacha20-poly1305@openssh.com,aes256-gcm@openssh.com,aes128-gcm@openssh.com
      ForwardX11 no
      ForwardAgent no
      ...
</pre></table></code></div></div></ul><h3 id="restrict-key-files-permissions"><span class="mr-2">Restrict key files permissions</span><a href="#restrict-key-files-permissions" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>chmod 700 ~/.ssh
chmod 600 ~/.ssh/id_*
chmod 64 ~/.ssh/known_hosts
</pre></table></code></div></div><h3 id="private-keys"><span class="mr-2">Private keys</span><a href="#private-keys" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Better with passphrase? The passphrase prevents the attacker from using the keys if they fall into the wrong hands.</p><h3 id="prefer-public-key-authentication"><span class="mr-2">Prefer public key authentication</span><a href="#prefer-public-key-authentication" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><code class="language-plaintext highlighter-rouge">PreferredAuthentications publickey</code></p><p>This forces the use of public keys as form of authentication.</p><h3 id="prioritizing-public-keys"><span class="mr-2">Prioritizing Public Keys</span><a href="#prioritizing-public-keys" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><code class="language-plaintext highlighter-rouge">PasswordAuthentication no</code></p><p>This ensures that our client always prioritizes the use of public keys above all other password-based methods.</p><h3 id="disable-host-based-authentication"><span class="mr-2">Disable host based authentication</span><a href="#disable-host-based-authentication" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><code class="language-plaintext highlighter-rouge">HostBasedAuthentication no</code></p><p>Host based authentication is less secure.</p><h3 id="key-verification"><span class="mr-2">Key verification</span><a href="#key-verification" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>We must force the client to verify that the server’s key matches the key stored in the <code class="language-plaintext highlighter-rouge">known_hosts</code> file to prevent Man-In-The-Middle (MITM) attacks. The relevant configuration options are setting <code class="language-plaintext highlighter-rouge">StrictHostKeyChecking</code> to <code class="language-plaintext highlighter-rouge">ask</code> or <code class="language-plaintext highlighter-rouge">yes</code>.</p><p>We need a balance between security and convenience. My preferred approach is to configure <code class="language-plaintext highlighter-rouge">StrictHostKeyChecking ask</code> for all hosts by default, and set <code class="language-plaintext highlighter-rouge">StrictHostKeyChecking yes</code> to sensitive hosts (like my own).</p><p>A change in a host key is usually due to legitimate administrative reasons (e.g. reinstallations, replacement, changes in key/type algorithms…). However, althoug less common, it could be due to malicious acts.</p><p>There are certain types of hosts where key changes are not uncommon, such as Capture The Flag (CTF) challenge servers or frequently rebuild virtual machines. But, on my own hosts, a change in keys should never happen without my knowledge.</p><p>By setting <code class="language-plaintext highlighter-rouge">StrickHostKeyChecking ask</code> globally, as default, and <code class="language-plaintext highlighter-rouge">StrictHostKeyChecking yes</code> for critical hosts, I can connect to a host susceptible to key changes and, if the key had changed, I can decide whether to accept the new key. Crucially, if the key had changed on a host where it should not, the strict setting will prevent the connection entirelly, inmediately alerting me to a potential security issue.</p><p>if the key had changed on a host where should not, I will find out something is wrong when I connect.</p><p><code class="language-plaintext highlighter-rouge">StrictHostKeyChecking ask</code></p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>* First connection: the SSH client will prompt you to manually confirm if you trust the server's key before adding it to your `known_hosts` file.
* Server key changed: The connection will be refused.
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">StrictHostKeyChecking yes</code></p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>* First connection: The SSH client will refuse the connection immediately if the host's key is not already present in your `known_hosts` file.
You must manually add the host key before attempting to connect.
* Server key changed: The connection will be refused.
</pre></table></code></div></div><h3 id="force-the-use-of-modern-algorithms-1"><span class="mr-2">Force the use of modern algorithms</span><a href="#force-the-use-of-modern-algorithms-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>On the client side, we will enforce the same strong ciphers that we chose for the server. This will ensure that, even if we connect to a legacy server, we will use the best available options.</p><h4 id="key-exchange-algorithms-1"><span class="mr-2">Key Exchange Algorithms</span><a href="#key-exchange-algorithms-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><code class="language-plaintext highlighter-rouge">KexAlgorithms curve25519-sha256@libssh.org,diffie-hellman-group-exchange-sha256</code></p><h4 id="macs-integrity-1"><span class="mr-2">MACs (integrity)</span><a href="#macs-integrity-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><code class="language-plaintext highlighter-rouge">MACs hmac-sha2-512-etm@openssh.com,hmac-sha2-256-etm@openssh.com,umac-128-etm@openssh.com</code></p><h4 id="ciphers-encryption-1"><span class="mr-2">Ciphers (Encryption)</span><a href="#ciphers-encryption-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><code class="language-plaintext highlighter-rouge">Ciphers chacha20-poly1305@openssh.com,aes256-gcm@openssh.com,aes128-gcm@openssh.com</code></p><h3 id="disable-x11-forwarding-1"><span class="mr-2">Disable X11 forwarding</span><a href="#disable-x11-forwarding-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>As on the server side, we will disable X11 forwarding to prevent exposing our graphical session.</p><p><code class="language-plaintext highlighter-rouge">ForwardX11 no</code></p><h3 id="disable-agent-forwarding-1"><span class="mr-2">Disable agent forwarding</span><a href="#disable-agent-forwarding-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>As on the server side, we will disable agent forwarding to prevent that a compromised server from using our keys to (potentially connect to other servers.</p><p><code class="language-plaintext highlighter-rouge">ForwardAgent no</code></p><h2 id="acknowledgments"><span class="mr-2">Acknowledgments</span><a href="#acknowledgments" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p><em>Thanks to <a href="https://rodrigorega.es/">Rodrigo Rega</a> and <a href="https://github.com/AlbertoMouriz">Alberto Mouriz</a> for the advice.</em></p><p><em>Thanks for reading! ;)</em></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/hardening/'>hardening</a>, <a href='/categories/ssh/'>ssh</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/hardening/" class="post-tag no-text-decoration" >hardening</a> <a href="/tags/ssh/" class="post-tag no-text-decoration" >ssh</a> <a href="/tags/fail2ban/" class="post-tag no-text-decoration" >fail2ban</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Essential%20SSH%20hardening%20guide%20(Server,%20client%20and%20fail2ban)%20-%20rubenhortas@blog&url=https%3A%2F%2Frubenhortas.github.io%2Fposts%2Fssh-hardening-server-client-fail2ban-guide%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Essential%20SSH%20hardening%20guide%20(Server,%20client%20and%20fail2ban)%20-%20rubenhortas@blog&u=https%3A%2F%2Frubenhortas.github.io%2Fposts%2Fssh-hardening-server-client-fail2ban-guide%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Frubenhortas.github.io%2Fposts%2Fssh-hardening-server-client-fail2ban-guide%2F" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/neovim-python-ide/">Configuring Neovim as Python IDE</a><li><a href="/posts/neovim-rust-ide/">Configuring Neovim as Rust IDE</a><li><a href="/posts/neovim-c-standard-ide/">Configuring Neovim as Standard C IDE</a><li><a href="/posts/pycharm-neovim-ruff-consistency/">Unify Python Linting. Syncing Ruff between PyCharm and Neovim</a><li><a href="/posts/check-ntp-servers-windows/">How to check NTP servers from Windows</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/hack-the-box/">hack the box</a> <a class="post-tag" href="/tags/challenge/">challenge</a> <a class="post-tag" href="/tags/gnu-linux/">gnu/linux</a> <a class="post-tag" href="/tags/administration/">administration</a> <a class="post-tag" href="/tags/personal/">personal</a> <a class="post-tag" href="/tags/hardening/">hardening</a> <a class="post-tag" href="/tags/htb/">htb</a> <a class="post-tag" href="/tags/programming/">programming</a> <a class="post-tag" href="/tags/python/">python</a> <a class="post-tag" href="/tags/ssh/">ssh</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc"></nav></div><script src="https://cdn.jsdelivr.net/npm/tocbot@4.20.1/dist/tocbot.min.js"></script></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4 mt-5"><div id="related-posts" class="mb-2 mb-sm-4"><h3 class="pt-2 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/ssh-without-password-using-rsa-keys/"><div class="card-body"> <em class="small" data-ts="1379203201" data-df="ll" > Sep 15, 2013 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>SSH without password, using RSA keys</h3><div class="text-muted small"><p> Suppose we have two computers: computer1 with ip 10.0.0.1 and computer2 with ip 10.0.0.2. We connect very frequently from computer1 to computer2 using SSH. As we connect very frequently, entering t...</p></div></div></a></div><div class="card"> <a href="/posts/fail2bangeolocation/"><div class="card-body"> <em class="small" data-ts="1657929601" data-df="ll" > Jul 16, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>fail2bangeolocation</h3><div class="text-muted small"><p> I have an old raspberry pi running some services 24/7 and with (very protected) remote access enabled. For some reason the raspberry receives a big number of bruteforce attacks trying to log in. To...</p></div></div></a></div><div class="card"> <a href="/posts/ssh-legacy-support/"><div class="card-body"> <em class="small" data-ts="1697328001" data-df="ll" > Oct 15, 2023 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>SSH legacy support</h3><div class="text-muted small"><p> Sometimes we found ourselves in the need of connect from, or to, old devices. With the passage of time it may that these devices and/or their applications became non upgradeable. Meanwhile, SSH kee...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/dynamic-firewall-rules-nftables-network-manager/" class="btn btn-outline-primary" prompt="Older"><p>Dynamic firewall rules with nftables and NetworkManager</p></a> <a href="/posts/ssh-optimization-guide/" class="btn btn-outline-primary" prompt="Newer"><p>SSH optimization guide</p></a></div></div></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/hack-the-box/">hack the box</a> <a class="post-tag" href="/tags/challenge/">challenge</a> <a class="post-tag" href="/tags/gnu-linux/">gnu/linux</a> <a class="post-tag" href="/tags/administration/">administration</a> <a class="post-tag" href="/tags/personal/">personal</a> <a class="post-tag" href="/tags/hardening/">hardening</a> <a class="post-tag" href="/tags/htb/">htb</a> <a class="post-tag" href="/tags/programming/">programming</a> <a class="post-tag" href="/tags/python/">python</a> <a class="post-tag" href="/tags/ssh/">ssh</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><footer><div class="container pl-lg-4 pr-lg-4"><div class="d-flex justify-content-between align-items-center text-muted ml-md-3 mr-md-3"><div class="footer-left"><p class="mb-0"> © 2026 <a href="https://github.com/rubenhortas">Rubén Hortas</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0">Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></div></footer><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lazysizes@5.3.2/lazysizes.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/unregister.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-NJBDP43045"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-NJBDP43045'); }); </script>
