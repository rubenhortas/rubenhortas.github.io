<!DOCTYPE html><html lang="en" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.3" /><meta property="og:title" content="iptables essential rules. A starting point to protect your computer" /><meta property="og:locale" content="en" /><meta name="description" content="Learn how to configure a firewall with iptables from scratch. Protect your Linux systems from attacks with this essential, basic configuration guide. This guide covers syntax, commands, best practices for a smooth transition, offers a good set of essential rules and includes bash script." /><meta property="og:description" content="Learn how to configure a firewall with iptables from scratch. Protect your Linux systems from attacks with this essential, basic configuration guide. This guide covers syntax, commands, best practices for a smooth transition, offers a good set of essential rules and includes bash script." /><link rel="canonical" href="https://rubenhortas.github.io/posts/iptables-essential-rules/" /><meta property="og:url" content="https://rubenhortas.github.io/posts/iptables-essential-rules/" /><meta property="og:site_name" content="rubenhortas@blog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2023-10-22T02:00:01+02:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="iptables essential rules. A starting point to protect your computer" /><meta name="twitter:site" content="@rubenhortas" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2025-06-17T21:37:49+02:00","datePublished":"2023-10-22T02:00:01+02:00","description":"Learn how to configure a firewall with iptables from scratch. Protect your Linux systems from attacks with this essential, basic configuration guide. This guide covers syntax, commands, best practices for a smooth transition, offers a good set of essential rules and includes bash script.","headline":"iptables essential rules. A starting point to protect your computer","mainEntityOfPage":{"@type":"WebPage","@id":"https://rubenhortas.github.io/posts/iptables-essential-rules/"},"url":"https://rubenhortas.github.io/posts/iptables-essential-rules/"}</script><title>iptables essential rules. A starting point to protect your computer | rubenhortas@blog</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="rubenhortas@blog"><meta name="application-name" content="rubenhortas@blog"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.20.1/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/avatar.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title"> <a href="/">rubenhortas@blog</a></div><div class="site-subtitle font-italic">Learning everyday</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="javascript:location.href = 'mailto:' + ['rubenhortas','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="https://www.linkedin.com/in/rubenhortas" aria-label="linkedin" target="_blank" rel="noopener noreferrer"> <i class="fab fa-linkedin"></i> </a> <a href="https://github.com/rubenhortas" aria-label="github" target="_blank" rel="noopener noreferrer"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/rubenhortas" aria-label="twitter" target="_blank" rel="noopener noreferrer"> <i class="fab fa-twitter"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>iptables essential rules. A starting point to protect your computer</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>iptables essential rules. A starting point to protect your computer</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1697932801" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Oct 22, 2023 </em> </span> <span> Updated <em class="" data-ts="1750189069" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Jun 17, 2025 </em> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://github.com/rubenhortas">Rubén Hortas</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1830 words"> <em>10 min</em> read</span></div></div></div><div class="post-content"><p>Learn how to configure a firewall with iptables from scratch. Protect your Linux systems from attacks with this essential, basic configuration guide. This guide covers syntax, commands, best practices for a smooth transition, offers a good set of essential rules and includes bash script.</p><h2 id="why"><span class="mr-2">Why?</span><a href="#why" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>All our computers should be using a firewall. Especially those that expose services to the internet.</p><p>Firewalls are crucial for mantaining the security of our network and protecting our data from external threats. They serve as a first line of defense against malware, cyber criminals and another threaths.</p><p>In this times, it’s a matter of minutes that botnets finds your exposed service and start attacking it. And this could be the beginning of a bad story…</p><p>I have an old raspberry pi exposing a SSH service to the internet, I need to connect to it remotely. The SSH access is secured using RSA authentication and fail2ban. But, once botnets discovers the SSH service running, the raspberry begins to receive such amount of petitions that the router is “<em>ddosed</em>” and the internet connection starts to cut. So I decided to set up a firewall to try to avoid network scans, at least those automated ones like those used by the botnets. I decided on iptables due to hardware and software restrictions, and, while I was at it, I also added protections to other kind of attacks and restrictions.</p><p>I learned a lot along the way, and that’s why I decided to put a configuration file here that I think it’s a good starting point to harden our systems.</p><h2 id="why-not"><span class="mr-2">Why not?</span><a href="#why-not" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p><a href="https://www.nftables.org/">nftables</a> is replacing iptables. Basically, nftables, avoids duplication of work and inconsistencies, is easier to configure and mantain and is faster. So, if you are looking for a more comfortable and modern alternative, I invite you to read my article: <a href="https://rubenhortas.github.io/posts/migrate-iptables-nftables/">Migrate from iptables to nftables. Boost your linux firewall performance</a>.</p><h2 id="iptables-bash-script-basic-rules-to-protect-your-system"><span class="mr-2">Iptables bash script. Basic rules to protect your system</span><a href="#iptables-bash-script-basic-rules-to-protect-your-system" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Here’s my iptables starting point rules (as bash script):</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
</pre><td class="rouge-code"><pre><span class="c">#!/usr/bin/env bash</span>

<span class="nv">bin</span><span class="o">=</span><span class="s2">"/sbin/iptables"</span>

<span class="c">#Flush rules</span>
<span class="nv">$bin</span> <span class="nt">-P</span> INPUT ACCEPT
<span class="nv">$bin</span> <span class="nt">-P</span> FORWARD ACCEPT
<span class="nv">$bin</span> <span class="nt">-P</span> OUTPUT ACCEPT
<span class="nv">$bin</span> <span class="nt">-t</span> nat <span class="nt">-F</span>
<span class="nv">$bin</span> <span class="nt">-t</span> mangle <span class="nt">-F</span>
<span class="nv">$bin</span> <span class="nt">-F</span>
<span class="nv">$bin</span> <span class="nt">-X</span>

<span class="c"># Set Default Policies (DROP everything first)</span>
<span class="nv">$bin</span> <span class="nt">-P</span> INPUT DROP
<span class="nv">$bin</span> <span class="nt">-P</span> OUTPUT DROP
<span class="nv">$bin</span> <span class="nt">-P</span> FORWARD DROP

<span class="c"># Allow all traffic on the loopback interface (the internal 127.0.0.1 address. Essential for local processes).</span>
<span class="nv">$bin</span> <span class="nt">-A</span> INPUT  <span class="nt">-i</span> lo <span class="nt">-j</span> ACCEPT
<span class="nv">$bin</span> <span class="nt">-A</span> OUTPUT <span class="nt">-o</span> lo <span class="nt">-j</span> ACCEPT

<span class="c"># Drop packets with invalid state</span>
<span class="nv">$bin</span> <span class="nt">-A</span> INPUT <span class="nt">-m</span> conntrack <span class="nt">--ctstate</span> INVALID <span class="nt">-j</span> DROP

<span class="c"># Allow Established/Related Connections (Crucial for allowing responses)</span>
<span class="nv">$bin</span> <span class="nt">-A</span> INPUT <span class="nt">-m</span> conntrack <span class="nt">--ctstate</span> ESTABLISHED,RELATED <span class="nt">-j</span> ACCEPT
<span class="nv">$bin</span> <span class="nt">-A</span> OUTPUT <span class="nt">-m</span> conntrack <span class="nt">--ctstate</span> ESTABLISHED,RELATED <span class="nt">-j</span> ACCEPT

<span class="c"># Block incoming traffic form the Zeroconf address range.</span>
<span class="c"># This range is used by hosts that use DHCP to adquire their IP address.</span>
<span class="c"># An address from this range is asigned when these hosts are unable to find a DHCP server to provide them an address.</span>
<span class="c"># This range is also usded to provide addressing when connecting two devices using a crossover cable.</span>
<span class="nv">$bin</span> <span class="nt">-A</span> INPUT <span class="nt">-s</span> 168.254.0.0/16 <span class="nt">-j</span> DROP

<span class="c"># Block incoming traffic coming from TEST-NET</span>
<span class="nv">$bin</span> <span class="nt">-A</span> INPUT <span class="nt">-s</span> 192.0.2.0/24 <span class="nt">-j</span> DROP

<span class="c"># Block incoming traffic coming from the reserved class D</span>
<span class="nv">$bin</span> <span class="nt">-A</span> INPUT <span class="nt">-s</span> 224.0.0.0/4 <span class="nt">-j</span> DROP

<span class="c"># Block incoming traffic coming from the reserved class E</span>
<span class="nv">$bin</span> <span class="nt">-A</span> INPUT <span class="nt">-s</span> 240.0.0.0/4 <span class="nt">-j</span> DROP

<span class="c"># Block incoming traffic coming from the loopback and zero addresses</span>
<span class="nv">$bin</span> <span class="nt">-A</span> INPUT <span class="nt">-s</span> 127.0.0.0/8 <span class="nt">-j</span> DROP
<span class="nv">$bin</span> <span class="nt">-A</span> INPUT <span class="nt">-s</span> 255.255.255.255/32 <span class="nt">-j</span> DROP
<span class="nv">$bin</span> <span class="nt">-A</span> INPUT <span class="nt">-s</span> 0.0.0.0/8 <span class="nt">-j</span> DROP

<span class="c"># Spoofing</span>
<span class="c"># Deny incoming traffic that has a source address of an IP address assigned to a local interface.</span>
<span class="c"># Incoming traffic with the source address of your system is going to be spoofed traffic because you know it cannot be generated by the host.</span>
<span class="nv">$bin</span> <span class="nt">-A</span> INPUT <span class="nt">-s</span> 192.168.1.100 <span class="nt">-j</span> DROP
<span class="nv">$bin</span> <span class="nt">-A</span> OUTPUT <span class="o">!</span> <span class="nt">-s</span> 192.168.1.100 <span class="nt">-j</span> DROP <span class="c"># Deny outgoing traffic that does not have a source address of an interface on the local host.</span>

<span class="c"># Port scanners</span>
<span class="c"># Drop packages if the connections are too agressive to avoid port scanning.</span>
<span class="nv">$bin</span> <span class="nt">-A</span> INPUT <span class="nt">-p</span> tcp <span class="nt">--syn</span> <span class="nt">-m</span> conntrack <span class="nt">--ctstate</span> NEW <span class="nt">-m</span> hashlimit <span class="nt">--hashlimit-name</span> port_scanners <span class="nt">--hashlimit-above</span> 5/second <span class="nt">--hashlimit-mode</span> srcip <span class="nt">-j</span> DROP
<span class="nv">$bin</span> <span class="nt">-A</span> INPUT <span class="nt">-p</span> udp <span class="nt">-m</span> conntrack <span class="nt">--ctstate</span> NEW <span class="nt">-m</span> hashlimit <span class="nt">--hashlimit-name</span> port_scanners <span class="nt">--hashlimit-above</span> 35/second <span class="nt">--hashlimit-mode</span> srcip <span class="nt">-j</span> DROP

<span class="c"># SSH</span>
<span class="c"># Allow incoming SSH connections</span>
<span class="c"># Deny outgoing connections is covered by the OUTPUT policy drop</span>
<span class="nv">$bin</span> <span class="nt">-A</span> INPUT <span class="nt">-p</span> tcp <span class="nt">--dport</span> ssh <span class="nt">-m</span> conntrack <span class="nt">--ctstate</span> NEW,ESTABLISHED <span class="nt">-j</span> ACCEPT
<span class="nv">$bin</span> <span class="nt">-A</span> OUTPUT <span class="nt">-p</span> tcp <span class="nt">--sport</span> ssh <span class="nt">-m</span> conntrack <span class="nt">--ctstate</span> ESTABLISHED <span class="nt">-j</span> ACCEPT

<span class="c"># NFSv4</span>
<span class="nv">$bin</span> <span class="nt">-A</span> INPUT <span class="nt">-p</span> tcp <span class="nt">--dport</span> 2049 <span class="nt">-m</span> conntrack <span class="nt">--ctstate</span> NEW,ESTABLISHED <span class="nt">-j</span> ACCEPT
<span class="nv">$bin</span> <span class="nt">-A</span> OUTPUT <span class="nt">-p</span> tcp <span class="nt">--sport</span> 2049 <span class="nt">-m</span> conntrack <span class="nt">--ctstate</span> ESTABLISHED <span class="nt">-j</span> ACCEPT

<span class="c"># Torrent</span>
<span class="nv">$bin</span> <span class="nt">-A</span> INPUT <span class="nt">-p</span> tcp <span class="nt">-m</span> multiport <span class="nt">--dport</span> 55555,55556 <span class="nt">-m</span> conntrack <span class="nt">--ctstate</span> ESTABLISHED <span class="nt">-j</span> ACCEPT
<span class="nv">$bin</span> <span class="nt">-A</span> OUTPUT <span class="nt">-p</span> tcp <span class="nt">-m</span> multiport <span class="nt">--sport</span> 55555,55556 <span class="nt">-m</span> conntrack <span class="nt">--ctstate</span> NEW,ESTABLISHED <span class="nt">-j</span> ACCEPT
<span class="nv">$bin</span> <span class="nt">-A</span> INPUT <span class="nt">-p</span> udp <span class="nt">-m</span> multiport <span class="nt">--dport</span> 55555,55556 <span class="nt">-m</span> conntrack <span class="nt">--ctstate</span> ESTABLISHED <span class="nt">-j</span> ACCEPT
<span class="nv">$bin</span> <span class="nt">-A</span> OUTPUT <span class="nt">-p</span> udp <span class="nt">-m</span> multiport <span class="nt">--sport</span> 55555,55556 <span class="nt">-m</span> conntrack <span class="nt">--ctstate</span> NEW,ESTABLISHED <span class="nt">-j</span> ACCEPT

<span class="c"># Torrent trackers</span>
<span class="nv">$bin</span> <span class="nt">-A</span> INPUT <span class="nt">-p</span> tcp <span class="nt">--sport</span> 2710 <span class="nt">-m</span> conntrack <span class="nt">--ctstate</span> ESTABLISHED <span class="nt">-m</span> conntrack <span class="nt">--ctstate</span> ESTABLISHED <span class="nt">-j</span> ACCEPT
<span class="nv">$bin</span> <span class="nt">-A</span> OUTPUT <span class="nt">-p</span> tcp <span class="nt">--dport</span> 2710 <span class="nt">-m</span> conntrack <span class="nt">--ctstate</span> NEW,ESTABLISHED <span class="nt">-m</span> conntrack <span class="nt">--ctstate</span> NEW,ESTABLISHED <span class="nt">-j</span> ACCEPT
<span class="nv">$bin</span> <span class="nt">-A</span> INPUT <span class="nt">-p</span> udp <span class="nt">-m</span> multiport <span class="nt">--sports</span> 80,451,1337,2710,2960,2980,6969,8080 <span class="nt">-m</span> conntrack <span class="nt">--ctstate</span> ESTABLISHED <span class="nt">-j</span> ACCEPT
<span class="nv">$bin</span> <span class="nt">-A</span> OUTPUT <span class="nt">-p</span> udp <span class="nt">-m</span> multiport <span class="nt">--dports</span> 80,451,1337,2710,2960,2980,6969,8080 <span class="nt">-m</span> conntrack <span class="nt">--ctstate</span> NEW,ESTABLISHED <span class="nt">-j</span> ACCEPT

<span class="c"># IRC</span>
<span class="c"># $bin -A INPUT -p tcp --sport 6697 -m conntrack --ctstate ESTABLISHED -j ACCEPT</span>
<span class="c"># $bin -A OUTPUT -p tcp --dport 6697 -m conntrack --ctstate NEW,ESTABLISHED -j ACCEPT</span>

<span class="c"># DNS</span>
<span class="nv">$bin</span> <span class="nt">-A</span> INPUT <span class="nt">-p</span> tcp <span class="nt">-m</span> multiport <span class="nt">--sports</span> 53,853 <span class="nt">-m</span> conntrack <span class="nt">--ctstate</span> ESTABLISHED <span class="nt">-j</span> ACCEPT
<span class="nv">$bin</span> <span class="nt">-A</span> OUTPUT <span class="nt">-p</span> tcp <span class="nt">-m</span> multiport <span class="nt">--dports</span> 53,853 <span class="nt">-m</span> conntrack <span class="nt">--ctstate</span> NEW,ESTABLISHED <span class="nt">-j</span> ACCEPT
<span class="nv">$bin</span> <span class="nt">-A</span> INPUT <span class="nt">-p</span> udp <span class="nt">-m</span> multiport <span class="nt">--sports</span> 53,853 <span class="nt">-m</span> conntrack <span class="nt">--ctstate</span> ESTABLISHED <span class="nt">-j</span> ACCEPT
<span class="nv">$bin</span> <span class="nt">-A</span> OUTPUT <span class="nt">-p</span> udp <span class="nt">-m</span> multiport <span class="nt">--dports</span> 53,853 <span class="nt">-m</span> conntrack <span class="nt">--ctstate</span> NEW,ESTABLISHED <span class="nt">-j</span> ACCEPT

<span class="c"># HTTP and HTTPS (Allow outgoing http/s connections)</span>
<span class="nv">$bin</span> <span class="nt">-A</span> INPUT <span class="nt">-p</span> tcp <span class="nt">-m</span> multiport <span class="nt">--sports</span> http,https <span class="nt">-m</span> conntrack <span class="nt">--ctstate</span> ESTABLISHED <span class="nt">-j</span> ACCEPT
<span class="nv">$bin</span> <span class="nt">-A</span> OUTPUT <span class="nt">-p</span> tcp <span class="nt">-m</span> multiport <span class="nt">--dports</span> http,https <span class="nt">-m</span> conntrack <span class="nt">--ctstate</span> NEW,ESTABLISHED <span class="nt">-j</span> ACCEPT

<span class="c"># NTP</span>
<span class="c"># test: $ ntpdate -q pool.ntp.org</span>
<span class="nv">$bin</span> <span class="nt">-A</span> INPUT <span class="nt">-p</span> udp <span class="nt">--sport</span> 123 <span class="nt">-m</span> conntrack <span class="nt">--ctstate</span> ESTABLISHED <span class="nt">-j</span> ACCEPT
<span class="nv">$bin</span> <span class="nt">-A</span> OUTPUT <span class="nt">-p</span> udp <span class="nt">--dport</span> 123 <span class="nt">-m</span> conntrack <span class="nt">--ctstate</span> NEW,ESTABLISHED <span class="nt">-j</span> ACCEPT

<span class="c"># Drop Packet fragments</span>
<span class="nv">$bin</span> <span class="nt">-A</span> INPUT <span class="nt">-f</span> <span class="nt">-j</span> DROP

<span class="c"># Bad Flags and other anomalies (Before legitimate traffic)</span>
<span class="nv">$bin</span> <span class="nt">-N</span> BAD_FLAGS
<span class="nv">$bin</span> <span class="nt">-A</span> INPUT <span class="nt">-p</span> tcp <span class="nt">-j</span> BAD_FLAGS
<span class="nv">$bin</span> <span class="nt">-A</span> BAD_FLAGS <span class="nt">-p</span> tcp <span class="nt">--tcp-flags</span> SYN,FIN SYN,FIN <span class="nt">-j</span> DROP
<span class="nv">$bin</span> <span class="nt">-A</span> BAD_FLAGS <span class="nt">-p</span> tcp <span class="nt">--tcp-flags</span> SYN,RST SYN,RST <span class="nt">-j</span> DROP
<span class="nv">$bin</span> <span class="nt">-A</span> BAD_FLAGS <span class="nt">-p</span> tcp <span class="nt">--tcp-flags</span> SYN,FIN,PSH SYN,FIN,PSH <span class="nt">-j</span> DROP
<span class="nv">$bin</span> <span class="nt">-A</span> BAD_FLAGS <span class="nt">-p</span> tcp <span class="nt">--tcp-flags</span> SYN,FIN,RST SYN,FIN,RST <span class="nt">-j</span> DROP
<span class="nv">$bin</span> <span class="nt">-A</span> BAD_FLAGS <span class="nt">-p</span> tcp <span class="nt">--tcp-flags</span> SYN,FIN,RST,PSH SYN,FIN,RST,PSH <span class="nt">-j</span> DROP
<span class="nv">$bin</span> <span class="nt">-A</span> BAD_FLAGS <span class="nt">-p</span> tcp <span class="nt">--tcp-flags</span> FIN FIN <span class="nt">-j</span> DROP
<span class="nv">$bin</span> <span class="nt">-A</span> BAD_FLAGS <span class="nt">-p</span> tcp <span class="nt">--tcp-flags</span> ALL NONE <span class="nt">-j</span> DROP
<span class="nv">$bin</span> <span class="nt">-A</span> BAD_FLAGS <span class="nt">-p</span> tcp <span class="nt">--tcp-flags</span> ALL ALL <span class="nt">-j</span> DROP
<span class="nv">$bin</span> <span class="nt">-A</span> BAD_FLAGS <span class="nt">-p</span> tcp <span class="nt">--tcp-flags</span> ALL FIN,URG,PSH <span class="nt">-j</span> DROP
<span class="nv">$bin</span> <span class="nt">-A</span> BAD_FLAGS <span class="nt">-p</span> tcp <span class="nt">--tcp-flags</span> ALL SYN,RST,ACK,FIN,URG <span class="nt">-j</span> DROP

<span class="c"># SYN flood</span>
<span class="nv">$bin</span> <span class="nt">-A</span> INPUT <span class="nt">-p</span> tcp <span class="nt">--syn</span> <span class="nt">-m</span> limit <span class="nt">--limit</span> 100/second <span class="nt">--limit-burst</span> 200 <span class="nt">-j</span> ACCEPT
<span class="nv">$bin</span> <span class="nt">-A</span> INPUT <span class="nt">-p</span> tcp <span class="nt">--syn</span> <span class="nt">-m</span> connlimit <span class="nt">--connlimit-above</span> 30 <span class="nt">--connlimit-mask</span> 32 <span class="nt">-j</span> REJECT <span class="nt">--reject-with</span> tcp-reset
<span class="nv">$bin</span> <span class="nt">-A</span> INPUT <span class="nt">-p</span> tcp <span class="nt">--syn</span> <span class="nt">-j</span> DROP

<span class="c"># ICMP</span>
<span class="c"># All ICMP responses should be barred except responses to outgoing connections.</span>
<span class="c"># Allow outbound echo messages and indbound echo reply messages -&gt; Allows the use of ping from the host.</span>
<span class="c"># Allow time exceeded and destination unreaachable messages inbound -&gt; Allow the use of tools such traceroute. </span>
<span class="c"># Avoids ICMP flood, ICMP smurf, Ping of death, ICMP nuke...</span>
<span class="nv">$bin</span> <span class="nt">-N</span> ICMP_IN
<span class="nv">$bin</span> <span class="nt">-N</span> ICMP_OUT
<span class="nv">$bin</span> <span class="nt">-A</span> INPUT <span class="nt">-p</span> icmp <span class="nt">-j</span> ICMP_IN
<span class="nv">$bin</span> <span class="nt">-A</span> OUTPUT <span class="nt">-p</span> icmp <span class="nt">-j</span> ICMP_OUT
<span class="nv">$bin</span> <span class="nt">-A</span> ICMP_IN <span class="nt">-p</span> icmp <span class="nt">--icmp-type</span> 0 <span class="nt">-m</span> conntrack <span class="nt">--ctstate</span> ESTABLISHED,RELATED <span class="nt">-j</span> ACCEPT
<span class="nv">$bin</span> <span class="nt">-A</span> ICMP_IN <span class="nt">-p</span> icmp <span class="nt">--icmp-type</span> 3 <span class="nt">-m</span> conntrack <span class="nt">--ctstate</span> ESTABLISHED,RELATED <span class="nt">-j</span> ACCEPT
<span class="nv">$bin</span> <span class="nt">-A</span> ICMP_IN <span class="nt">-p</span> icmp <span class="nt">--icmp-type</span> 8 <span class="nt">-m</span> conntrack <span class="nt">--ctstate</span> NEW <span class="nt">-j</span> DROP <span class="c"># Only NEW echo requests are dropped</span>
<span class="nv">$bin</span> <span class="nt">-A</span> ICMP_IN <span class="nt">-p</span> icmp <span class="nt">--icmp-type</span> 11 <span class="nt">-m</span> conntrack <span class="nt">--ctstate</span> ESTABLISHED,RELATED <span class="nt">-j</span> ACCEPT
<span class="nv">$bin</span> <span class="nt">-A</span> ICMP_OUT <span class="nt">-p</span> icmp <span class="nt">--icmp-type</span> 8 <span class="nt">-m</span> conntrack <span class="nt">--ctstate</span> NEW,ESTABLISHED <span class="nt">-j</span> ACCEPT
</pre></table></code></div></div><h2 id="making-iptables-rules-persistent"><span class="mr-2">Making iptables rules persistent</span><a href="#making-iptables-rules-persistent" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>If we don’t persist our rules, they will be deleted upon reboot.</p><p>The best and recommended way to make iptables rules persistent is by using the <code class="language-plaintext highlighter-rouge">iptables-persistent</code> package.</p><p>If we don’t have <code class="language-plaintext highlighter-rouge">iptables-persistent</code> installed, we install it:</p><p><code class="language-plaintext highlighter-rouge">sudo apt install iptables-persistent</code></p><ul><li>During the installation, you will be prompted whether to save your current IPv4 and IPv6 rules. Choose “Yes” for both if you have already configured your firewall.</ul><p>To save our current rulings (if we skipped during installation or we made changes):</p><p><code class="language-plaintext highlighter-rouge">sudo netfilter-persistent save</code></p><ul><li>The iptables-persistent service is automatically configured to load the rules from iptables (ipv4) and ip6tables (ipv6) during system startup.</ul><h2 id="important-considerations-when-using-this-iptables-configuration"><span class="mr-2">Important considerations when using this iptables configuration</span><a href="#important-considerations-when-using-this-iptables-configuration" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>If you are going to use this as configuration basis rember a few things:</p><ul><li>Check the configuration and <strong>set the parameters of your computer</strong> (e.g.: set your computer ip address, interface[s], and the packet limits of the rules).<li>These are basically protection rules and only allows basic common services as DNS, SSH, NTP and HTTP[S]. Below you have to add the rules that allow legitimate services traffic from your host.<li>Think about your computer needs. Every host has needs and they may not be the same as mine.<li>I set these rules without specify interfaces.In some hosts different interfaces have different needs.<li>In iptables the order of the rules matter.<li>Using the <code class="language-plaintext highlighter-rouge">recent</code> or <code class="language-plaintext highlighter-rouge">limit</code>modules instead <code class="language-plaintext highlighter-rouge">hashlimit</code> could improve the performance.<li>Don’t forget about IPv6. These are rules for IPv4, but changing the <code class="language-plaintext highlighter-rouge">$bin</code> variable to use <code class="language-plaintext highlighter-rouge">ip6tables</code> could apply to IPv6.</ul><p>Thanks to <a href="https://rodrigorega.es/">Rodrigo Rega</a> for the tips and annotations :)</p><p><em>Enjoy! ;)</em></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/hardening/'>hardening</a>, <a href='/categories/firewall/'>firewall</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/hardening/" class="post-tag no-text-decoration" >hardening</a> <a href="/tags/firewall/" class="post-tag no-text-decoration" >firewall</a> <a href="/tags/iptables/" class="post-tag no-text-decoration" >iptables</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=iptables%20essential%20rules.%20A%20starting%20point%20to%20protect%20your%20computer%20-%20rubenhortas@blog&url=https%3A%2F%2Frubenhortas.github.io%2Fposts%2Fiptables-essential-rules%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=iptables%20essential%20rules.%20A%20starting%20point%20to%20protect%20your%20computer%20-%20rubenhortas@blog&u=https%3A%2F%2Frubenhortas.github.io%2Fposts%2Fiptables-essential-rules%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Frubenhortas.github.io%2Fposts%2Fiptables-essential-rules%2F" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/neovim-python-ide/">Configuring Neovim as Python IDE</a><li><a href="/posts/neovim-rust-ide/">Configuring Neovim as Rust IDE</a><li><a href="/posts/neovim-c-standard-ide/">Configuring Neovim as Standard C IDE</a><li><a href="/posts/pycharm-neovim-ruff-consistency/">Unify Python Linting. Syncing Ruff between PyCharm and Neovim</a><li><a href="/posts/check-ntp-servers-windows/">How to check NTP servers from Windows</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/hack-the-box/">hack the box</a> <a class="post-tag" href="/tags/challenge/">challenge</a> <a class="post-tag" href="/tags/gnu-linux/">gnu/linux</a> <a class="post-tag" href="/tags/administration/">administration</a> <a class="post-tag" href="/tags/personal/">personal</a> <a class="post-tag" href="/tags/hardening/">hardening</a> <a class="post-tag" href="/tags/htb/">htb</a> <a class="post-tag" href="/tags/programming/">programming</a> <a class="post-tag" href="/tags/python/">python</a> <a class="post-tag" href="/tags/ssh/">ssh</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc"></nav></div><script src="https://cdn.jsdelivr.net/npm/tocbot@4.20.1/dist/tocbot.min.js"></script></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4 mt-5"><div id="related-posts" class="mb-2 mb-sm-4"><h3 class="pt-2 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/migrate-iptables-nftables/"><div class="card-body"> <em class="small" data-ts="1749859201" data-df="ll" > Jun 14, 2025 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Migrate from iptables to nftables. Boost your Linux firewall performance</h3><div class="text-muted small"><p> Learn the essential steps to migrate your Linux firewall configurations from iptables to nftables. This guide covers syntax, commands, best practices for a smooth transition and offers a good set o...</p></div></div></a></div><div class="card"> <a href="/posts/nftables-dynamic-anti-spoofing-networkmanager/"><div class="card-body"> <em class="small" data-ts="1755302401" data-df="ll" > Aug 16, 2025 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>How to prevent IP spoofing with nftables and NetworkManager</h3><div class="text-muted small"><p> Add dynamic IP anti-spoofing rules to your nftables firewall with NetworkManager. Prevent spoofing of your computer’s network interfaces using dynamic nftables rules. Why? I while ago I wrote my ...</p></div></div></a></div><div class="card"> <a href="/posts/dynamic-firewall-rules-nftables-network-manager/"><div class="card-body"> <em class="small" data-ts="1756512001" data-df="ll" > Aug 30, 2025 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Dynamic firewall rules with nftables and NetworkManager</h3><div class="text-muted small"><p> Dynamically implement IPv4 and IPv6 firewall rules for each network interface with nftables and NetworkManager. If the interface comes online or changes IP, the rules are automatically updated. If ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/ssh-legacy-support/" class="btn btn-outline-primary" prompt="Older"><p>SSH legacy support</p></a> <a href="/posts/new-avatar/" class="btn btn-outline-primary" prompt="Newer"><p>New avatar</p></a></div></div></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/hack-the-box/">hack the box</a> <a class="post-tag" href="/tags/challenge/">challenge</a> <a class="post-tag" href="/tags/gnu-linux/">gnu/linux</a> <a class="post-tag" href="/tags/administration/">administration</a> <a class="post-tag" href="/tags/personal/">personal</a> <a class="post-tag" href="/tags/hardening/">hardening</a> <a class="post-tag" href="/tags/htb/">htb</a> <a class="post-tag" href="/tags/programming/">programming</a> <a class="post-tag" href="/tags/python/">python</a> <a class="post-tag" href="/tags/ssh/">ssh</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><footer><div class="container pl-lg-4 pr-lg-4"><div class="d-flex justify-content-between align-items-center text-muted ml-md-3 mr-md-3"><div class="footer-left"><p class="mb-0"> © 2026 <a href="https://github.com/rubenhortas">Rubén Hortas</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0">Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></div></footer><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lazysizes@5.3.2/lazysizes.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/unregister.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-NJBDP43045"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-NJBDP43045'); }); </script>
