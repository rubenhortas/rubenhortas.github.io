<!DOCTYPE html><html lang="en" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.3" /><meta property="og:title" content="Upload a package to PyPI automatically with GitHub Actions" /><meta property="og:locale" content="en" /><meta name="description" content="Some time ago, I wrote the post Upload a package to PyPI, but, how everything evolves, this time I decided to evolve and take advantage of all the power of GitHub Actions." /><meta property="og:description" content="Some time ago, I wrote the post Upload a package to PyPI, but, how everything evolves, this time I decided to evolve and take advantage of all the power of GitHub Actions." /><link rel="canonical" href="https://rubenhortas.github.io/posts/upload-package-pypi-github-actions/" /><meta property="og:url" content="https://rubenhortas.github.io/posts/upload-package-pypi-github-actions/" /><meta property="og:site_name" content="rubenhortas@blog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2024-11-02T01:00:01+01:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Upload a package to PyPI automatically with GitHub Actions" /><meta name="twitter:site" content="@rubenhortas" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2025-09-07T01:15:39+02:00","datePublished":"2024-11-02T01:00:01+01:00","description":"Some time ago, I wrote the post Upload a package to PyPI, but, how everything evolves, this time I decided to evolve and take advantage of all the power of GitHub Actions.","headline":"Upload a package to PyPI automatically with GitHub Actions","mainEntityOfPage":{"@type":"WebPage","@id":"https://rubenhortas.github.io/posts/upload-package-pypi-github-actions/"},"url":"https://rubenhortas.github.io/posts/upload-package-pypi-github-actions/"}</script><title>Upload a package to PyPI automatically with GitHub Actions | rubenhortas@blog</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="rubenhortas@blog"><meta name="application-name" content="rubenhortas@blog"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.20.1/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/avatar.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title"> <a href="/">rubenhortas@blog</a></div><div class="site-subtitle font-italic">Learning everyday</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="javascript:location.href = 'mailto:' + ['rubenhortas','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="https://www.linkedin.com/in/rubenhortas" aria-label="linkedin" target="_blank" rel="noopener noreferrer"> <i class="fab fa-linkedin"></i> </a> <a href="https://github.com/rubenhortas" aria-label="github" target="_blank" rel="noopener noreferrer"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/rubenhortas" aria-label="twitter" target="_blank" rel="noopener noreferrer"> <i class="fab fa-twitter"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Upload a package to PyPI automatically with GitHub Actions</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Upload a package to PyPI automatically with GitHub Actions</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1730505601" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Nov 2, 2024 </em> </span> <span> Updated <em class="" data-ts="1757200539" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Sep 7, 2025 </em> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://github.com/rubenhortas">RubÃ©n Hortas</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1864 words"> <em>10 min</em> read</span></div></div></div><div class="post-content"><p>Some time ago, I wrote the post <a href="https://rubenhortas.github.io/posts/upload-package-pypi/">Upload a package to PyPI</a>, but, how everything evolves, this time I decided to evolve and take advantage of all the power of <a href="https://docs.github.com/en/actions">GitHub Actions</a>.</p><h1 id="github-actions">GitHub actions</h1><p><a href="https://docs.github.com/en/actions">GitHub actions</a> allows us to automate, customize and execute development workflows right in our github repositories. With <a href="https://docs.github.com/en/actions">GitHub actions</a> we can automate a lot of tasks (build, tests, deployments, code reviews, issue managementâ€¦) when an event occurs in our repository. <a href="https://docs.github.com/en/actions">GitHub actions</a> itâ€™s a very powerful tool, I have to say that, for me, it has been like discovering a new world.</p><p>To automate our tasks, <a href="https://github.com">GitHub</a> will suggest us some workflows based on the repository type, we can create our own workflows, but we can use workflows created by other users using the <a href="https://github.com/marketplace?type=actions">Actions Marketplace</a> and we can modfify workflows done by other users (advantages of the open source :P).</p><p>In my case, I want to automate the publishing of my project <a href="https://github.com/rubenhortas/fail2bangeolocation">fail2bangeolocation</a> to <a href="https://test.pypi.org/">testpypi.org</a> and <a href="https://pypi.org/">pypi.org</a> under certain events. The first thing I though about was taking advantage of some workflow written by the community. But, after reviewing some workflows in <a href="https://github.com">GitHub</a> and the <a href="https://github.com/marketplace?type=actions">Actions Marketplace</a>, I saw that they didnâ€™t quite fit what I wanted, and I decided to write my own workflow based on some of them.</p><h1 id="publishing-using-github-actions">Publishing using GitHub actions</h1><h2 id="requirements"><span class="mr-2">Requirements</span><a href="#requirements" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li><p>A package with the required structure</p><p>To publish our python package to <a href="https://pypi.org/">pypi.org</a>, weâ€™ll need to adhere to a specific project structure. The structure can vary a bit, but, there is a basic example of the required structure:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre>/project
â”œâ”€â”€ LICENSE
â”œâ”€â”€ pyproject.toml
â”œâ”€â”€ README.md
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ src
â”‚Â Â  â”œâ”€â”€ project
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ module
â”‚Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€...
â”‚Â Â  â”‚Â Â  â””â”€â”€...
â”‚Â Â  â””â”€â”€...
â””â”€â”€ tests
  Â  â””â”€â”€...
</pre></table></code></div></div><li><p><a href="https://test.pypi.org/">testpypi.org</a> and <a href="https://pypi.org/">pypi.org</a> accounts</p><p>Having a <a href="https://test.pypi.org/">testpypi.org</a> itâ€™s optional, but itâ€™s recomended. Uploading the package first to <a href="https://test.pypi.org/">testpypi.org</a>, we can check if there are problems, and we can check how the upload went before going into production (publishing in <a href="https://pypi.org/">pypi.org</a>).</p></ul><h1 id="configuring-trusted-publishing">Configuring trusted publishing</h1><p>Trusted publishing exchanges short-lived tokens (using <a href="https://openid.net/developers/how-connect-works/">OpenID Connect (OIDC)</a>) between a trusted third-party service (in our case <a href="https://github.com">GitHub</a>) and <a href="https://test.pypi.org/">testpypi.org</a> and/or <a href="https://pypi.org/">pypi.org</a>. Trusted publishing method can be used in automated environments and eliminates the need to use manually generated API tokens to authenticate with <a href="https://test.pypi.org/">testpypi.org</a> and/or <a href="https://pypi.org/">pypi.org</a> when publishing.</p><p>The steps to crete a [pending] publisher in <a href="https://test.pypi.org/">testpypi.org</a> and <a href="https://pypi.org/">pypi.org</a>, are basically the same.</p><blockquote class="prompt-info"><p>I had the project upload to <a href="https://test.pypi.org/">testpypi.org</a> and <a href="https://pypi.org/">pypi.org</a>, but If you donâ€™t have your project uploaded yet, you can create a <a href="https://docs.pypi.org/trusted-publishers/creating-a-project-through-oidc/">â€œpendingâ€ trusted publisher</a>.</p></blockquote><h2 id="configuring-trusted-publishing-in-testpypi"><span class="mr-2">Configuring trusted publishing in testpypi</span><a href="#configuring-trusted-publishing-in-testpypi" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>We go to our <a href="https://test.pypi.org/">testpypi.org</a> account, we go to â€œ<em>Your projects</em>â€ and we select our project (in my case <em><a href="https://github.com/rubenhortas/fail2bangeolocation">fail2bangeolocation</a></em>), and we click in â€œ<em>Manage</em>â€:</p><p><a href="/assets/img/posts/pypi-your-projects.png" class="popup img-link shadow shimmer"><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 700 600'%3E%3C/svg%3E" data-src="/assets/img/posts/pypi-your-projects.png" alt="Manage" width="700" height="600" class="lazyload" data-proofer-ignore></a> <em>testpypi manage your project</em></p><p>We go to â€œ<em>Publishing</em>â€:</p><p><a href="/assets/img/posts/pypi-publishing.png" class="popup img-link shadow shimmer"><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 700 600'%3E%3C/svg%3E" data-src="/assets/img/posts/pypi-publishing.png" alt="Publishing" width="700" height="600" class="lazyload" data-proofer-ignore></a> <em>testpypi publishing</em></p><p>Under â€œ<em>Trusted Publisher Management</em>â€ we add a new publisher:</p><p><a href="/assets/img/posts/testpypi-new-publisher.png" class="popup img-link shadow shimmer"><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 700 600'%3E%3C/svg%3E" data-src="/assets/img/posts/testpypi-new-publisher.png" alt="New publisher" width="700" height="600" class="lazyload" data-proofer-ignore></a> <em>testpypi new publisher</em></p><p>Here we will set the owner, the repository name, the workflow name and the environment name:</p><ul><li><strong>Owner</strong>: Our github user.<li><strong>Repository name</strong>: Our github repository name.<li><strong>Workflow name</strong>: The file name of our (future) workflow, here I will use â€œ<strong>publish.yml</strong>â€.<li><strong>Enviromnment name</strong>: The name of the GitHub Actions environment that the workflow will use, here I will use â€œ<strong>testpypi</strong>â€.</ul><blockquote class="prompt-warning"><p>We have to pay attention to the workflow and environment names. We will need them later.</p></blockquote><p>Click on â€œ<em>Add</em>â€ and we are done! ;)</p><blockquote class="prompt-info"><p>It should be noted that, many times, we will not be able to install the package generated in testpypi in on our machine (or it may not work) due to dependency problems. This is because the same packages (or the same versions) may not be available in testpypi as in pypi.</p></blockquote><h2 id="configuring-trusted-publishing-in-pypi"><span class="mr-2">Configuring trusted publishing in pypi:</span><a href="#configuring-trusted-publishing-in-pypi" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>We go to our <a href="https://pypi.org/">pypi.org</a> account, we go to â€œ<em>Your projects</em>â€ and we select our project (in my case <em><a href="https://github.com/rubenhortas/fail2bangeolocation">fail2bangeolocation</a></em>), and we click in â€œ<em>Manage</em>â€:</p><p><a href="/assets/img/posts/pypi-your-projects.png" class="popup img-link shadow shimmer"><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 700 600'%3E%3C/svg%3E" data-src="/assets/img/posts/pypi-your-projects.png" alt="Manage" width="700" height="600" class="lazyload" data-proofer-ignore></a> <em>pypi manage your project</em></p><p>We go to â€œ<em>Publishing</em>â€:</p><p><a href="/assets/img/posts/pypi-publishing.png" class="popup img-link shadow shimmer"><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 700 600'%3E%3C/svg%3E" data-src="/assets/img/posts/pypi-publishing.png" alt="Publishing" width="700" height="600" class="lazyload" data-proofer-ignore></a> <em>pypi publishing</em></p><p>Under â€œ<em>Trusted Publisher Management</em>â€ we add a new publisher:</p><p><a href="/assets/img/posts/pypi-new-publisher.png" class="popup img-link shadow shimmer"><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 700 600'%3E%3C/svg%3E" data-src="/assets/img/posts/pypi-new-publisher.png" alt="New publisher" width="700" height="600" class="lazyload" data-proofer-ignore></a> <em>pypi new publisher</em></p><p>Here we will set the owner, the repository name, the workflow name and the environment name:</p><ul><li><strong>Owner</strong>: Our github user.<li><strong>Repository name</strong>: Our github repository name.<li><strong>Workflow name</strong>: The file name of our (future) workflow, here I will use â€œ<strong>publish.yml</strong>â€.<li><strong>Enviromnment name</strong>: The name of the GitHub Actions environment that the workflow will use, here I will use â€œ<strong>pypi</strong>â€.</ul><blockquote class="prompt-warning"><p>We have to pay attention to the workflow and environment names. We will need them later.</p></blockquote><p>Click on â€œ<em>Add</em>â€ and we are done! ;)</p><h1 id="adding-the-workflow">Adding the workflow</h1><blockquote class="prompt-warning"><p>The worflow file name has to match the name we gave it when we created the trusted trusted-publishers</p></blockquote><p>GitHub CI/CD workflows are declared in YAML files stored in the <code class="language-plaintext highlighter-rouge">.github/workflows/</code> directory of our repositories. So, we can create a <code class="language-plaintext highlighter-rouge">.github/workflows/publish.yml</code> file, or, we can create it from the <a href="https://github.com">GitHub web interface</a>.</p><p>To create the action from the <a href="https://github.com">GitHub web interface</a>, we go to our repository and select â€œ<em>Actions</em>â€:</p><p><a href="/assets/img/posts/fail2bangeolocation-actions.png" class="popup img-link shadow shimmer"><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 700 600'%3E%3C/svg%3E" data-src="/assets/img/posts/fail2bangeolocation-actions.png" alt="GitHub Actions" width="700" height="600" class="lazyload" data-proofer-ignore></a> <em>GitHub actions</em></p><p>Now, we will see some suggested actions for our repository, but, this time, we will create our own clicking in â€œ<em>set up a workflow yourself</em>â€:</p><p><a href="/assets/img/posts/get-started-with-github-actions.png" class="popup img-link shadow shimmer"><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 700 600'%3E%3C/svg%3E" data-src="/assets/img/posts/get-started-with-github-actions.png" alt="Set a workflow yourself" width="700" height="600" class="lazyload" data-proofer-ignore></a> <em>Get started with GitHub Actions - Set up a workflow yourself</em></p><p>In the editor, we have to create a workflow <strong>with a file name that matches the name we gave it when we created the trusted-publishers</strong>:</p><p><a href="/assets/img/posts/github-actions-new-workflow.png" class="popup img-link shadow shimmer"><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 700 600'%3E%3C/svg%3E" data-src="/assets/img/posts/github-actions-new-workflow.png" alt="New workflow" width="700" height="600" class="lazyload" data-proofer-ignore></a> <em>New workflow</em></p><p>We write (or paste) our workflow, we commit the changes and we are ready to publish!</p><h1 id="the-workflow">The workflow</h1><blockquote class="prompt-info"><p>The environment names have to match with the enviroment names we gave them wen we created the trusted-publishers.</p></blockquote><p>You can see my workflow here: <a href="https://github.com/rubenhortas/fail2bangeolocation/blob/main/.github/workflows/publish.yml">fail2bangeolocation publish.yml</a>, but Iâ€™m going to copy it and explain it (briefly) here below:</p><div class="language-yml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
</pre><td class="rouge-code"><pre><span class="na">name</span><span class="pi">:</span> <span class="s">Publish Python distribution ğŸğŸ“¦</span>

<span class="c1"># The workflow is triggered when events taht include that includes tagas starting with v*.*.* or test_v*.*.*. are sent to the repository.</span>
<span class="na">on</span><span class="pi">:</span>
  <span class="na">push</span><span class="pi">:</span>
    <span class="na">tags</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s1">'</span><span class="s">v*.*.*'</span>
      <span class="pi">-</span> <span class="s1">'</span><span class="s">test_v*.*.*'</span>

<span class="na">jobs</span><span class="pi">:</span>
<span class="c1"># Builds the pythond distribution (wheel and source tarball)</span>
  <span class="na">build</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">Build distribution ğŸ“¦</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>

    <span class="na">steps</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/checkout@v4</span> <span class="c1"># Checkout the code</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Set up Python</span>
      <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/setup-python@v5</span> <span class="c1"># Set up the Python environment</span>
      <span class="na">with</span><span class="pi">:</span>
        <span class="na">python-version</span><span class="pi">:</span> <span class="s2">"</span><span class="s">3.x"</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Install pypa/build</span> <span class="c1"># Install the build tool</span>
      <span class="na">run</span><span class="pi">:</span> <span class="pi">&gt;-</span>
        <span class="s">python3 -m</span>
        <span class="s">pip install</span>
        <span class="s">build</span>
        <span class="s">--user</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Build a binary wheel and a source tarball</span>
      <span class="na">run</span><span class="pi">:</span> <span class="s">python3 -m build</span> <span class="c1"># Build the package</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Store the distribution packages</span> <span class="c1"># Temporarily store the build artifacts in the dist directory under the name python-package-distributions</span>
      <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/upload-artifact@v4</span>
      <span class="na">with</span><span class="pi">:</span>
        <span class="na">name</span><span class="pi">:</span> <span class="s">python-package-distributions</span>
        <span class="na">path</span><span class="pi">:</span> <span class="s">dist/</span>

<span class="c1"># Publishes the built package to TestPyPI (for testing) if the tag starts with test_v.*</span>
  <span class="na">publish-to-testpypi</span><span class="pi">:</span>
      <span class="na">name</span><span class="pi">:</span> <span class="s">Publish to TestPyPI ğŸğŸ“¦</span>
      <span class="na">needs</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">build</span> <span class="c1"># Start the job only if the build job has completed</span>
      <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>

      <span class="na">environment</span><span class="pi">:</span>
        <span class="na">name</span><span class="pi">:</span> <span class="s">testpypi</span> <span class="c1"># Enter the environment name set in the Publisher</span>
        <span class="na">url</span><span class="pi">:</span> <span class="s">https://test.pypi.org/p/example-package-hanaosan0318</span> <span class="c1"># Project URL</span>

      <span class="na">permissions</span><span class="pi">:</span>
        <span class="na">id-token</span><span class="pi">:</span> <span class="s">write</span>  <span class="c1"># Grant Publishing permissions</span>

      <span class="na">if</span><span class="pi">:</span> <span class="s">startsWith(github.ref, 'refs/tags/test_v')</span> <span class="c1"># Conditional check for TestPyPI publishing</span>

      <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Download all the dists</span> <span class="c1"># Download the build artifacts that were saved earlier</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/download-artifact@v4</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">name</span><span class="pi">:</span> <span class="s">python-package-distributions</span>
          <span class="na">path</span><span class="pi">:</span> <span class="s">dist/</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Publish distribution ğŸ“¦ to TestPyPI</span> <span class="c1"># Publish to TestPyPI</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">pypa/gh-action-pypi-publish@release/v1</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">repository-url</span><span class="pi">:</span> <span class="s">https://test.pypi.org/legacy/</span>

<span class="s">Publishes the built package to PyPI (production) if the tag starts with v.*</span>
  <span class="s">publish-to-pypi</span><span class="err">:</span>
      <span class="na">name</span><span class="pi">:</span> <span class="s">Publish to PyPI ğŸ ğŸ“¦</span>
      <span class="na">needs</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">build</span> <span class="c1"># Start the job only if the build job has completed</span>
      <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>

      <span class="na">environment</span><span class="pi">:</span>
        <span class="na">name</span><span class="pi">:</span> <span class="s">pypi</span> <span class="c1"># Enter the environment name set in the Publisher</span>
        <span class="na">url</span><span class="pi">:</span> <span class="s">https://pypi.org/p/example-package-hanaosan0318</span> <span class="c1"># Project URL</span>

      <span class="na">permissions</span><span class="pi">:</span>
        <span class="na">id-token</span><span class="pi">:</span> <span class="s">write</span>

      <span class="na">if</span><span class="pi">:</span> <span class="s">startsWith(github.ref, 'refs/tags/v')</span> <span class="c1"># Conditional check for PyPI publishing</span>

      <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Download all the dists</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/download-artifact@v4</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">name</span><span class="pi">:</span> <span class="s">python-package-distributions</span>
          <span class="na">path</span><span class="pi">:</span> <span class="s">dist/</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Publish distribution ğŸ“¦ to PyPI</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">pypa/gh-action-pypi-publish@release/v1</span>

  <span class="na">github-release</span><span class="pi">:</span>
      <span class="na">name</span><span class="pi">:</span> <span class="s">Create GitHub Release with source code ğŸ“¦</span>
      <span class="na">needs</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">publish-to-pypi</span> <span class="c1"># Start the job only if the PyPI publishing job has completed</span>
      <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>

      <span class="na">permissions</span><span class="pi">:</span>
        <span class="na">contents</span><span class="pi">:</span> <span class="s">write</span> <span class="c1"># Grant permission to create a GitHub release</span>

      <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Checkout code</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/checkout@v4</span> <span class="c1"># Checkout the code</span>

      <span class="c1"># I had to escape the braces in the following block. Replace them if you copy this.</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Create GitHub Release</span>
        <span class="na">env</span><span class="pi">:</span>
          <span class="na">GITHUB_TOKEN</span><span class="pi">:</span> <span class="s">$\{\{ secrets.GITHUB_TOKEN \}\}</span> <span class="c1"># A temporary token that is automatically generated each time the workflow is run</span>
        <span class="na">run</span><span class="pi">:</span> <span class="pi">&gt;-</span>
          <span class="s">gh release create</span>
          <span class="s">'$\{\{ github.ref_name \}\}'</span>
          <span class="s">--repo '$\{\{ github.repository \}\}'</span>
          <span class="s">--notes "Release for version $\{\{ github.ref_name \}\}"</span>
</pre></table></code></div></div><h2 id="publishyml-workflow-tldr"><span class="mr-2">publish.yml workflow TL;DR</span><a href="#publishyml-workflow-tldr" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>This workflow automates building, publishing (to <a href="https://test.pypi.org/">testpypi.org</a> and <a href="https://pypi.org/">pypi.org</a>), and creating a <a href="https://github.com">GitHub</a> release for your Python package.</p><p>This workflow is triggered when a version tag is pushed. The tag will be a label that match the patterns <code class="language-plaintext highlighter-rouge">test_v*.*.*</code> or <code class="language-plaintext highlighter-rouge">v*.*.*.</code>.</p><p>This workflow will do a (slightly) different job depending on the type of tag:</p><ul><li><p>If a <code class="language-plaintext highlighter-rouge">test_v*.*.*</code> tag (e.g. <code class="language-plaintext highlighter-rouge">test_v1.0.1</code>) is pushed, a test version will be generated. The workflow will build the distribution packages and upload them to <a href="https://test.pypi.org/">testpypi.org</a>.</p><li><p>If a <code class="language-plaintext highlighter-rouge">v*.*.*</code> tag (e.g. <code class="language-plaintext highlighter-rouge">v1.0.1</code>) is pushed, the relase version will be generated. The workflow will build the packages, upload them to <a href="https://pypi.org/">pypi.org</a> <strong>and generate the GitHub release</strong>.</p></ul><h2 id="why-i-decided-to-write-my-own-workflow"><span class="mr-2">Why I decided to write my own workflow?</span><a href="#why-i-decided-to-write-my-own-workflow" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>The reason why I decided to write my own workflow is because the workflows I saw depended on other events, and, usually, they did a lot of work together (as publish to <a href="https://test.pypi.org/">testpypi.org</a>, <a href="https://pypi.org/">pypi.org</a> and generate the <a href="https://github.com">GitHub</a> release at the same time). I prefer a slightly more structured workflow, based on pushing version tags. And, I want to perform slightly different actions based on these tags.</p><p>Publishing the test version first in <a href="https://test.pypi.org/">testpypi.org</a> let me know if there are any errorsm and let me know the result of the distribution files. Once I have verified that the upload to <a href="https://test.pypi.org/">testpypi.org</a> is correct, and the distribution files have been checked, I can generate the production version, upload it to <a href="https://pypi.org/">pypi.org</a> and generate the <a href="https://github.com">GitHub</a> release.</p><h2 id="why-i-wanted-to-publish-based-on-tags"><span class="mr-2">Why I wanted to publish based on tags?</span><a href="#why-i-wanted-to-publish-based-on-tags" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>When you upload a package to <a href="https://test.pypi.org/">testpypi.org</a> or <a href="https://pypi.org/">pypi.org</a>, you canâ€™t repeat versions. With this workflow I can create a <code class="language-plaintext highlighter-rouge">dev</code> branch to add changes and upload test versions to <a href="https://test.pypi.org/">testpypi.org</a>. In case there are errors when uploading to <a href="https://test.pypi.org/">testpypi.org</a>, I can increase the project version, until everything is correct, without affecting the production version number. Once everything is correct I can merge the <code class="language-plaintext highlighter-rouge">dev</code> branch changes into the <code class="language-plaintext highlighter-rouge">main</code> branch, tag the production version in <code class="language-plaintext highlighter-rouge">main</code>, and the production release will be generated automatically (ideally without errors). Once the release version is published I will take care of cleaning up the versions in <a href="https://test.pypi.org/">testpypi.org</a>, and, if necessary, in <a href="https://pypi.org/">pypi.org</a>.</p><p><em>Enjoy! ;)</em></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/python/'>python</a>, <a href='/categories/pypi/'>pypi</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/programming/" class="post-tag no-text-decoration" >programming</a> <a href="/tags/python/" class="post-tag no-text-decoration" >python</a> <a href="/tags/pypi/" class="post-tag no-text-decoration" >pypi</a> <a href="/tags/github/" class="post-tag no-text-decoration" >github</a> <a href="/tags/github-actions/" class="post-tag no-text-decoration" >github actions</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Upload%20a%20package%20to%20PyPI%20automatically%20with%20GitHub%20Actions%20-%20rubenhortas@blog&url=https%3A%2F%2Frubenhortas.github.io%2Fposts%2Fupload-package-pypi-github-actions%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Upload%20a%20package%20to%20PyPI%20automatically%20with%20GitHub%20Actions%20-%20rubenhortas@blog&u=https%3A%2F%2Frubenhortas.github.io%2Fposts%2Fupload-package-pypi-github-actions%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Frubenhortas.github.io%2Fposts%2Fupload-package-pypi-github-actions%2F" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/neovim-python-ide/">Configuring Neovim as Python IDE</a><li><a href="/posts/neovim-rust-ide/">Configuring Neovim as Rust IDE</a><li><a href="/posts/neovim-c-standard-ide/">Configuring Neovim as Standard C IDE</a><li><a href="/posts/pycharm-neovim-ruff-consistency/">Unify Python Linting. Syncing Ruff between PyCharm and Neovim</a><li><a href="/posts/check-ntp-servers-windows/">How to check NTP servers from Windows</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/hack-the-box/">hack the box</a> <a class="post-tag" href="/tags/challenge/">challenge</a> <a class="post-tag" href="/tags/gnu-linux/">gnu/linux</a> <a class="post-tag" href="/tags/administration/">administration</a> <a class="post-tag" href="/tags/personal/">personal</a> <a class="post-tag" href="/tags/hardening/">hardening</a> <a class="post-tag" href="/tags/htb/">htb</a> <a class="post-tag" href="/tags/programming/">programming</a> <a class="post-tag" href="/tags/python/">python</a> <a class="post-tag" href="/tags/ssh/">ssh</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc"></nav></div><script src="https://cdn.jsdelivr.net/npm/tocbot@4.20.1/dist/tocbot.min.js"></script></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4 mt-5"><div id="related-posts" class="mb-2 mb-sm-4"><h3 class="pt-2 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/upload-package-pypi/"><div class="card-body"> <em class="small" data-ts="1658448001" data-df="ll" > Jul 22, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Upload a package to PyPI</h3><div class="text-muted small"><p> Although the Packaging Python Projects tutorial is very detailed in how to package a Python Project, I encountered some difficulties at the time of do it, so Iâ€™m going to leave here a summary and s...</p></div></div></a></div><div class="card"> <a href="/posts/python-web-server/"><div class="card-body"> <em class="small" data-ts="1654214401" data-df="ll" > Jun 3, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Python web server</h3><div class="text-muted small"><p> If we want to test a web site or share some files with another person we can have a web server running quickly with python only running one command: Run a web server on the current directory: ...</p></div></div></a></div><div class="card"> <a href="/posts/python-charset-detection/"><div class="card-body"> <em class="small" data-ts="1654819201" data-df="ll" > Jun 10, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Python charset detection</h3><div class="text-muted small"><p> We can use the chardet module to detect the charset (or character encoding) of a file. This can come handy when we need to analyze a text file. To install chardet: $ sudo pip3 install chardet No...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/git-dotfiles/" class="btn btn-outline-primary" prompt="Older"><p>Organize your dotfiles with git</p></a> <a href="/posts/migrate-iptables-nftables/" class="btn btn-outline-primary" prompt="Newer"><p>Migrate from iptables to nftables. Boost your Linux firewall performance</p></a></div></div></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/hack-the-box/">hack the box</a> <a class="post-tag" href="/tags/challenge/">challenge</a> <a class="post-tag" href="/tags/gnu-linux/">gnu/linux</a> <a class="post-tag" href="/tags/administration/">administration</a> <a class="post-tag" href="/tags/personal/">personal</a> <a class="post-tag" href="/tags/hardening/">hardening</a> <a class="post-tag" href="/tags/htb/">htb</a> <a class="post-tag" href="/tags/programming/">programming</a> <a class="post-tag" href="/tags/python/">python</a> <a class="post-tag" href="/tags/ssh/">ssh</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><footer><div class="container pl-lg-4 pr-lg-4"><div class="d-flex justify-content-between align-items-center text-muted ml-md-3 mr-md-3"><div class="footer-left"><p class="mb-0"> Â© 2026 <a href="https://github.com/rubenhortas">RubÃ©n Hortas</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0">Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></div></footer><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lazysizes@5.3.2/lazysizes.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/unregister.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-NJBDP43045"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-NJBDP43045'); }); </script>
